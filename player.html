<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Player</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body{margin:0;background:black}
video{width:100%;height:100vh}
</style>
</head>
<body>
<video id="video" controls autoplay></video>

<script>
Telegram.WebApp.ready();
const params = new URLSearchParams(location.search);
const url = params.get("src");
const id = params.get("id");
const video = document.getElementById("video");

if(url.endsWith(".m3u8") && Hls.isSupported()){
  const hls = new Hls();
  hls.loadSource(url);
  hls.attachMedia(video);
}else{
  video.src = url;
}

// save last watched
localStorage.setItem("last_watched", id);

// count views
const views = JSON.parse(localStorage.getItem("views")||"{}");
views[id] = (views[id]||0)+1;
localStorage.setItem("views", JSON.stringify(views));
</script>
</body>
</html>
